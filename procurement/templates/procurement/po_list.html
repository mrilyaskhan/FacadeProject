{% extends 'base.html' %}

{% block content %}
<div class="d-flex align-items-center justify-content-between mb-3 po-list-header">
    <!-- Title with icon -->
    <h4 class="m-0 text-dark">
        <i class="bi bi-file-earmark-text me-2"></i> Purchase Orders
    </h4>

    <div class="d-flex align-items-center gap-2">
        <!-- Create PO button -->
        <a href="{% url 'po_add' %}" class="btn btn-sm btn-primary px-4">Create PO</a>

        <!-- Search form -->
        <form method="get" class="mx-auto">
            <div class="input-group input-group-sm shadow-sm rounded-pill overflow-hidden border" style="height: 38px; max-width: 280px;">
                <span class="input-group-text bg-white border-0">
                    <i class="bi bi-search text-dark"></i>
                </span>
                <input type="text" name="q" class="form-control border-0"
                       placeholder="Search purchase orders..."
                       value="{{ request.GET.q|default:'' }}" style="font-size: 14px;">
                <button class="btn btn-dark border-0 rounded-0 rounded-end" type="submit">Go</button>
            </div>
        </form>
    </div>
</div>

<table class="table po-list-table">
    <thead class="po-table-head">
        <tr>
            <th>PO#</th>
            <th>Supplier</th>
            <th>Status</th>
            <th>Date</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        {% for po in pos %}
        <tr>
            <td><a href="{% url 'po_detail' po.pk %}">{{ po.po_number }}</a></td>
            <td>{{ po.supplier }}</td>
            <td>{{ po.get_status_display }}</td>
            <td>{{ po.order_date }}</td>
           <td class="d-flex gap-1">
              <a href="{% url 'po_detail' po.pk %}" class="btn btn-sm btn-info">View</a>
              <a href="{% url 'po_delete' po.pk %}" class="btn btn-sm btn-danger"
                 onclick="return confirm('Are you sure you want to delete this PO?');">
                 Delete
              </a>
          </td>

        </tr>
        {% empty %}
        <tr>
            <td colspan="5" class="text-center">No POs yet.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- Pagination aligned bottom right -->
<div class="d-flex justify-content-end mt-2">
    <nav aria-label="Page navigation">
        <ul class="pagination mb-0">
            {% if pos.has_previous %}
            <li class="page-item">
                <a class="page-link px-2 py-1" href="?page={{ pos.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">&laquo; Previous</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link px-2 py-1">&laquo; Previous</span>
            </li>
            {% endif %}

            {% for num in pos.paginator.page_range %}
                {% if num >= pos.number|add:-2 and num <= pos.number|add:2 %}
                    {% if pos.number == num %}
                    <li class="page-item active">
                        <span class="page-link px-2 py-1">{{ num }}</span>
                    </li>
                    {% else %}
                    <li class="page-item">
                        <a class="page-link px-2 py-1" href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">{{ num }}</a>
                    </li>
                    {% endif %}
                {% endif %}
            {% endfor %}

            {% if pos.has_next %}
            <li class="page-item">
                <a class="page-link px-2 py-1" href="?page={{ pos.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}">Next &raquo;</a>
            </li>
            {% else %}
            <li class="page-item disabled">
                <span class="page-link px-2 py-1">Next &raquo;</span>
            </li>
            {% endif %}
        </ul>
    </nav>
</div>
{% endblock %}
